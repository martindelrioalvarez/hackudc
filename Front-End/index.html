<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizador de Viajes</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Optimizador de Viajes Sostenibles</h1>
        <p>Minimiza tu huella de carbono al viajar</p>
    </header>
    <main>
        <section id="form-section">
            <form id="travel-form">
                <fieldset>
                    <legend>Información del Viaje</legend>
                    <div id="traveler-info">
                        <label for="origin-1">Ciudad de Origen del Viajero 1:</label>
                        <input type="text" id="origin-1" name="origin[]" required placeholder="Introduce la ciudad de origen" autocomplete="off">
                        <div id="citySuggestions-1" class="suggestions-container"></div>
                    </div>
                    <button type="button" id="add-traveler">Añadir otro viajero</button>
                    <label for="destination">Destino:</label>
                    <input type="text" id="destination" name="destination" required placeholder="Introduce la ciudad de destino" autocomplete="off">
                    <div id="destinationSuggestions" class="suggestions-container"></div>

                    <!-- Campo de fecha de salida -->
                    <div id="departure-date">
                        <label for="departure-date">Fecha de Salida:</label>
                        <input type="date" id="departure-date" name="departure-date" required>
                    </div>

                    <button type="submit">Calcular Ruta y Huella de Carbono</button>
                </fieldset>
            </form>
        </section>
        <section id="results-section" style="display:none;">
            <h2>Resultados del Viaje</h2>
            <div id="travel-options"></div>
            <div id="carbon-footprint"></div>
        </section>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const addButton = document.getElementById('add-traveler');
            const travelerInfo = document.getElementById('traveler-info');
            let travelerCount = 1;

            function addTraveler() {
              travelerCount++;
              const newField = document.createElement('div');
              newField.innerHTML = `
                  <label for="origin-${travelerCount}">Ciudad de Origen del Viajero ${travelerCount}:</label>
                  <input type="text" id="origin-${travelerCount}" name="origin[]" required placeholder="Introduce la ciudad de origen" autocomplete="off">
                  <div id="citySuggestions-${travelerCount}" class="suggestions-container"></div>
                  <button type="button" class="remove-traveler">Eliminar</button>
              `;
              travelerInfo.appendChild(newField);

              // Añadir funcionalidad de autocompletado al nuevo campo de entrada
              autocompleteCities(`origin-${travelerCount}`, `citySuggestions-${travelerCount}`);

              // Añadir funcionalidad para eliminar el viajero recién añadido
              newField.querySelector('.remove-traveler').addEventListener('click', function() {
                  travelerInfo.removeChild(newField); // Eliminar el div del viajero
                  travelerCount--; // Decrementar el contador de viajeros
              });
            }


            addButton.addEventListener('click', addTraveler);

            // Función para autocompletar ciudades en todos los campos de origen y destino
            function autocompleteCities(inputId, suggestionsId) {
                const inputField = document.getElementById(inputId);
                const suggestionsContainer = document.getElementById(suggestionsId);

                inputField.addEventListener('input', function (event) {
                    const inputText = event.target.value;

                    suggestionsContainer.innerHTML = '';

                    if (!inputText) return;

                    fetch(`https://api.geoapify.com/v1/geocode/autocomplete?text=${inputText}&apiKey=258dc386de524d2f96f96152852a5414`)
                        .then(response => response.json())
                        .then(data => {
                            const suggestions = data.features.map(feature => {
                                // Aquí extraes solo el nombre de la ciudad, omitiendo el país y el código postal.
                                const city = feature.properties.city || feature.properties.name; // Usa el nombre de la ciudad si está disponible, si no, usa el nombre general.
                                return city;
                            });

                            // Elimina duplicados
                            const uniqueSuggestions = Array.from(new Set(suggestions));

                            uniqueSuggestions.forEach(city => {
                                let div = document.createElement("div");
                                div.innerHTML = city;
                                div.onclick = function () {
                                    inputField.value = this.innerText;
                                    suggestionsContainer.innerHTML = '';
                                };
                                suggestionsContainer.appendChild(div);
                            });
                        })
                        .catch(error => {
                            console.error('Error fetching suggestions:', error);
                        });
                });
            }

            // Autocompletar ciudades para el primer campo de origen
            autocompleteCities('origin-1', 'citySuggestions-1');

            // Autocompletar ciudades para los campos de origen adicionales
            for (let i = 2; i <= travelerCount; i++) {
                autocompleteCities(`origin-${i}`, `citySuggestions-${i}`);
            }

            // Autocompletar ciudades para el campo de destino
            autocompleteCities('destination', 'destinationSuggestions');
        });
    </script>
</body>
</html>